<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nodejs | 技术学派</title>
    <meta name="description" content="Web前端技术、干货、教程、课程笔记">
    <link rel="icon" href="/favicon.ico">
  <meta name="robots" content="all">
  <meta name="author" content="likang">
  <meta name="keywords" content="Web全栈知识体系, web体系, web知识体系, web框架, web详解, web学习路线, web spring, web面试, 知识体系, web技术体系, web编程, web编程指南,web开发体系, web开发,web教程,web,web数据结构, 算法, 开发基础">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <script src="https://hm.baidu.com/hm.js?a2fd998a0322a08f10309f035d7009e1"></script>
    
    <link rel="preload" href="/assets/css/0.styles.c9eb7bf0.css" as="style"><link rel="preload" href="/assets/js/app.36f33a9d.js" as="script"><link rel="preload" href="/assets/js/2.d27f56d2.js" as="script"><link rel="preload" href="/assets/js/4.e3d63e9c.js" as="script"><link rel="prefetch" href="/assets/js/10.d1e6c66a.js"><link rel="prefetch" href="/assets/js/11.29746d89.js"><link rel="prefetch" href="/assets/js/12.0605b152.js"><link rel="prefetch" href="/assets/js/13.3b6be312.js"><link rel="prefetch" href="/assets/js/14.e0cf0d42.js"><link rel="prefetch" href="/assets/js/15.86f20d18.js"><link rel="prefetch" href="/assets/js/16.a660308b.js"><link rel="prefetch" href="/assets/js/17.2c6ab243.js"><link rel="prefetch" href="/assets/js/18.e8ce1763.js"><link rel="prefetch" href="/assets/js/19.34c3af53.js"><link rel="prefetch" href="/assets/js/20.3fa7618a.js"><link rel="prefetch" href="/assets/js/21.4c157aad.js"><link rel="prefetch" href="/assets/js/22.47eb5636.js"><link rel="prefetch" href="/assets/js/23.cd435639.js"><link rel="prefetch" href="/assets/js/24.990a63e1.js"><link rel="prefetch" href="/assets/js/25.47122bec.js"><link rel="prefetch" href="/assets/js/26.05b4f7ae.js"><link rel="prefetch" href="/assets/js/27.9ab1d9bc.js"><link rel="prefetch" href="/assets/js/28.50943c3b.js"><link rel="prefetch" href="/assets/js/29.bd08d43b.js"><link rel="prefetch" href="/assets/js/3.2c8e19c4.js"><link rel="prefetch" href="/assets/js/30.cd670f1e.js"><link rel="prefetch" href="/assets/js/31.fc962975.js"><link rel="prefetch" href="/assets/js/32.16de1a8c.js"><link rel="prefetch" href="/assets/js/33.5331101e.js"><link rel="prefetch" href="/assets/js/34.1df38d3f.js"><link rel="prefetch" href="/assets/js/35.2e0c63f6.js"><link rel="prefetch" href="/assets/js/5.0fc728f0.js"><link rel="prefetch" href="/assets/js/6.596668dc.js"><link rel="prefetch" href="/assets/js/7.5a102747.js"><link rel="prefetch" href="/assets/js/8.53b312d6.js"><link rel="prefetch" href="/assets/js/9.0ec4f429.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c9eb7bf0.css">   
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">技术学派</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/notes/" class="nav-link router-link-active">主线课程大纲</a></div><div class="nav-item"><a href="/techs.html" class="nav-link">技术栈</a></div><div class="nav-item"><a href="/nav.html" class="nav-link">网站导航</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端编码规范" class="dropdown-title"><span class="title">前端编码规范</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/rules/html.html" class="nav-link">HTML 编码规范</a></li><li class="dropdown-item"><!----> <a href="/rules/css.html" class="nav-link">CSS 编码规范</a></li><li class="dropdown-item"><!----> <a href="/rules/js.html" class="nav-link">JavaScript 编码规范</a></li><li class="dropdown-item"><!----> <a href="/specification.html" class="nav-link">文档编写规范</a></li></ul></div></div><div class="nav-item"><a href="/tips.html" class="nav-link">学习建议</a></div><div class="nav-item"><a href="/discuss.html" class="nav-link">留言</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/notes/" class="nav-link router-link-active">主线课程大纲</a></div><div class="nav-item"><a href="/techs.html" class="nav-link">技术栈</a></div><div class="nav-item"><a href="/nav.html" class="nav-link">网站导航</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端编码规范" class="dropdown-title"><span class="title">前端编码规范</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/rules/html.html" class="nav-link">HTML 编码规范</a></li><li class="dropdown-item"><!----> <a href="/rules/css.html" class="nav-link">CSS 编码规范</a></li><li class="dropdown-item"><!----> <a href="/rules/js.html" class="nav-link">JavaScript 编码规范</a></li><li class="dropdown-item"><!----> <a href="/specification.html" class="nav-link">文档编写规范</a></li></ul></div></div><div class="nav-item"><a href="/tips.html" class="nav-link">学习建议</a></div><div class="nav-item"><a href="/discuss.html" class="nav-link">留言</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Nodejs</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/Nodejs/#第一章-nodejs介绍" class="sidebar-link">第一章 Nodejs介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/Nodejs/#第一节-简介" class="sidebar-link">第一节 简介</a></li><li class="sidebar-sub-header"><a href="/notes/Nodejs/#第二节-安装" class="sidebar-link">第二节 安装</a></li><li class="sidebar-sub-header"><a href="/notes/Nodejs/#第三节-模块" class="sidebar-link">第三节 模块</a></li><li class="sidebar-sub-header"><a href="/notes/Nodejs/#第四节-nodejs和浏览器中js的区别" class="sidebar-link">第四节 Nodejs和浏览器中js的区别</a></li></ul></li><li><a href="/notes/Nodejs/#第二章-http-模块" class="sidebar-link">第二章 http 模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/Nodejs/#第一节-网络基础及http协议" class="sidebar-link">第一节 网络基础及HTTP协议</a></li><li class="sidebar-sub-header"><a href="/notes/Nodejs/#第二节-web服务器" class="sidebar-link">第二节 Web服务器</a></li><li class="sidebar-sub-header"><a href="/notes/Nodejs/#第三节-web客户端" class="sidebar-link">第三节 Web客户端</a></li></ul></li><li><a href="/notes/Nodejs/#第三章-fs模块" class="sidebar-link">第三章 fs模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/Nodejs/#第一节-文件操作" class="sidebar-link">第一节 文件操作</a></li><li class="sidebar-sub-header"><a href="/notes/Nodejs/#第二节-目录操作" class="sidebar-link">第二节 目录操作</a></li></ul></li><li><a href="/notes/Nodejs/#第四章-path模块" class="sidebar-link">第四章 path模块</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/Nodejs/#第二章-url模块" class="sidebar-link">第二章 url模块</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/Nodejs/#第五章-querystring模块" class="sidebar-link">第五章 querystring模块</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/Nodejs/#第六章-events模块" class="sidebar-link">第六章 events模块</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/Nodejs/#第七章-utilities模块" class="sidebar-link">第七章 utilities模块</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/Nodejs/#第八章-express-框架" class="sidebar-link">第八章 Express 框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/Nodejs/#第一节-使用express构造web服务器" class="sidebar-link">第一节 使用Express构造Web服务器</a></li><li class="sidebar-sub-header"><a href="/notes/Nodejs/#response" class="sidebar-link">response</a></li><li class="sidebar-sub-header"><a href="/notes/Nodejs/#静态文件" class="sidebar-link">静态文件</a></li><li class="sidebar-sub-header"><a href="/notes/Nodejs/#路由" class="sidebar-link">路由</a></li><li class="sidebar-sub-header"><a href="/notes/Nodejs/#中间件" class="sidebar-link">中间件</a></li></ul></li><li><a href="/notes/Nodejs/#第九章-koa-框架" class="sidebar-link">第九章 Koa 框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/Nodejs/#第一节-koa-介绍" class="sidebar-link">第一节 Koa 介绍</a></li><li class="sidebar-sub-header"><a href="/notes/Nodejs/#第二节-hello-koa" class="sidebar-link">第二节 Hello Koa</a></li><li class="sidebar-sub-header"><a href="/notes/Nodejs/#第三节-中间件-middleware" class="sidebar-link">第三节 中间件 middleware</a></li><li class="sidebar-sub-header"><a href="/notes/Nodejs/#第四节-路由" class="sidebar-link">第四节 路由</a></li><li class="sidebar-sub-header"><a href="/notes/Nodejs/#第五节-控制器-controller" class="sidebar-link">第五节 控制器 Controller</a></li></ul></li><li><a href="/notes/Nodejs/#附录：" class="sidebar-link">附录：</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/Nodejs/#实用工具" class="sidebar-link">实用工具</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nodejs"><a href="#nodejs" class="header-anchor">#</a> Nodejs</h1> <h2 id="第一章-nodejs介绍"><a href="#第一章-nodejs介绍" class="header-anchor">#</a> 第一章 Nodejs介绍</h2> <h3 id="第一节-简介"><a href="#第一节-简介" class="header-anchor">#</a> 第一节 简介</h3> <p>JavaScript语言的设计初衷是为了操作客户端（前端）页面的DOM元素，进行页面交互，常规的 Javascript 运行在浏览器环境中，这限定了 Javascript 的定位和功能，比如不能随意的访问电脑上的文件，因为这对浏览器来说是非常不安全的。</p> <p>简单来说， Node.js 就是运行在服务端（后端）的 JavaScript。 对于语言本身来说，并不存在前后之分。</p> <p>后端主要的工作就是响应用户请求，根据请求提供相应服务，包括：</p> <p>文件操作、数据存取（操作数据库）、平台的稳定性、优化性能 等。</p> <p>后端的主要开发程序有：PHP、JAVA 、ASP.net、python、ruby等等。这些程序的运行，都需要在服务器上部署不同的语言环境。</p> <p>那么，问题来了！ JavaScript的运行环境是浏览器，后端又没有浏览器，怎么运行 JavaScript？？</p> <p><strong>2009年，大神来了！！！！</strong></p> <p><img src="/assets/img/RyanDahl.7416b836.jpg" alt="Ryan Dahl"></p> <h4 id="发展史"><a href="#发展史" class="header-anchor">#</a> 发展史</h4> <p>2009年2月，Ryan Dahl在博客上宣布准备基于V8引擎（谷歌浏览器里面的js引擎）创建一个轻量级的Web服务器并提供一套库。
2009年5月，Ryan Dahl在GitHub上发布了最初版本的部分Node.js包，随后几个月里，有人开始使用Node.js开发应用。
2009年11月和2010年4月，两届JSConf大会都安排了Node.js的讲座。
2010年年底，Node.js获得云计算服务商Joyent资助，创始人Ryan Dahl加入Joyent全职负责Node.js的发展。
2011年7月，Node.js在微软的支持下发布Windows版本。</p> <ul><li>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境。</li> <li>Node.js 使用了一个事件驱动、非阻塞式 I/O 的模型，使其轻量又高效。</li> <li>Node.js 的包管理器 npm，是全球最大的开源库生态系统。</li></ul> <p><a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">nodeJS官网(英文)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="http://nodejs.cn/" target="_blank" rel="noopener noreferrer">nodeJS中文网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="优点"><a href="#优点" class="header-anchor">#</a> 优点</h4> <ol><li>采用事件驱动、异步编程，为网络服务而设计。JavaScript简单易学，前端工程师很快上手。</li> <li>Node.js非阻塞模式的IO处理，低系统资源消耗，高性能负载，非常适合用作依赖其它IO资源的中间层服务。</li> <li>Node.js轻量高效，可以认为是数据密集型分布式部署环境下的实时应用系统的完美解决方案。Node非常适合前端有大量的异步请求，需要服务后端有极高的响应速度，但所需的服务器端逻辑和处理不一定很多，单页面、多Ajax请求应用——如mail，聊天。不适合CPU使用率较重、IO使用率较轻的应用——如视频编码。</li> <li>跨平台(window\linux\unix\mac)</li></ol> <p><strong>多线程服务器</strong></p> <p>大部分后端语言，都采用的是多线程（Multi Threaded ）的方式，同一时刻，可以响应多个请求，并开启多个线程同时处理，但是，对于多线程的管理需要复杂的线程调度，容易造成线程堵塞，如图：</p> <p><img src="/assets/img/muti_thread.451256d9.jpg" alt="images/muti_thread.jpg"></p> <p><strong>node服务器</strong></p> <p>Node Server使用的是js语言，js的运行机制是非堵塞单线程，同一时刻，js将响应的多个请求，添加至**事件队列（task queue）<strong>中，并通过</strong>事件循环（event loop）<strong>机制来管理队列的执行，将事件按照先后顺序压入</strong>执行栈（stack）**执行任务，如图：</p> <p><img src="/assets/img/node_thread.202ce35d.jpg" alt="images/node_thread.jpg"></p> <blockquote><p>**阻塞式 I/O **</p> <p>线程在执行中如果遇到磁盘读写或网络通信（统称为 I/O 操作）， 通常要耗费较长的时间，这时操作系统会剥夺这个线程的 CPU 控制权，使其暂停执行，同时将资源让给其他的工作线程，这种线程调度方式称为 阻塞。当 I/O 操作完毕时，操作系统 将这个线程的阻塞状态解除，恢复其对CPU的控制权，令其继续执行。这种 I/O 模式就是通常的阻塞式 I/O （Blocking I/O）或称为同步式 I/O（Synchronous I/O）</p> <p><strong>非阻塞式I/O</strong></p> <p>是针对 所有 I/O 操作不采用阻塞的策略。当线程遇到 I/O 操作时，不会以阻塞的方式等待 I/O 操作 的完成或数据的返回，而只是将 I/O 请求发送给操作系统，继续执行下一条语句。当操作 系统完成 I/O 操作时，以事件的形式通知执行 I/O 操作的线程，线程会在特定时候处理这个事件。为了处理异步 I/O，<strong>线程必须有事件循环</strong>，不断地检查有没有未处理的事件，依次予以处理。这种 I/O 模式就是非阻塞式I/O或称为异步式 I/O （Asynchronous I/O）</p></blockquote> <h4 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点</h4> <p>可靠性低：单进程（单线程），只支持单核CPU，不能充分利用多核CPU。一旦这个进程崩掉，整个web服务就崩掉了。</p> <h3 id="第二节-安装"><a href="#第二节-安装" class="header-anchor">#</a> 第二节 安装</h3> <p>Node.js安装包及源码下载地址为：<a href="https://nodejs.org/en/download/" target="_blank" rel="noopener noreferrer">https://nodejs.org/en/download/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <ol><li>直接下载对应操作系统的安装文件，安装步骤（略）</li> <li>配置全局PATH环境</li></ol> <p><img src="images/1.png" alt="27"></p> <p>LTS： 长期稳定版。 实际项目开发建议使用长期稳定版。</p> <p>Current： 最新版。最新版包含了一些新功能，如果想学习最新的功能，则可以使用该版本。但是，最新版可能会有一些未知的bug。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>node -v
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="node执行js代码"><a href="#node执行js代码" class="header-anchor">#</a> node执行js代码</h4> <p>node可以脱离浏览器执行js代码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>node xxx.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="全局对象"><a href="#全局对象" class="header-anchor">#</a> 全局对象</h4> <p>在 Nodejs 中可以操作 DOM 吗？不能。不在浏览器中没有 DOM 可以操作，所以也没有用来操作 DOM 的 window 全局对象。Nodejs 中的全局对象是<code>global</code>。</p> <table><thead><tr><th>属性</th> <th>说明</th></tr></thead> <tbody><tr><td>global</td> <td>全局的命名空间对象(全局对象)</td></tr> <tr><td>console</td> <td>控制台</td></tr> <tr><td>Buffer</td> <td>用于处理二进制数据</td></tr> <tr><td>__dirname</td> <td>全局变量 返回被执行的 js 所在文件夹的绝对路径<br>在 require() 中使用 ./  跟  __dirname 的效果相同</td></tr> <tr><td>__filename</td> <td>全局变量 返回被执行的 js 的绝对路径</td></tr> <tr><td>process</td> <td>用于访问进程信息</td></tr> <tr><td>module</td> <td>对当前模块的引用</td></tr> <tr><td>exports</td> <td>这是一个对于 <code>module.exports</code> 的更简短的引用形式</td></tr> <tr><td>require( module )</td> <td>引入模块</td></tr> <tr><td>setImmediate(cb[, …args])</td> <td>即时定时器（立即执行），它是在事件轮询之后执行,为了防止轮询阻塞,每次只会调用一个。</td></tr> <tr><td>clearImmediate(immediateObject)</td> <td>清除setImmediate定时器</td></tr> <tr><td>setInterval(cb, ms)</td> <td>间隔定时器</td></tr> <tr><td>clearInterval( intervalObject )</td> <td>清除setInterval定时器</td></tr> <tr><td>setTimeout(cb, ms)</td> <td>超时定时器</td></tr> <tr><td>clearTimeout( timeoutObject )</td> <td>清除setTimeout定时器</td></tr></tbody></table> <h3 id="第三节-模块"><a href="#第三节-模块" class="header-anchor">#</a> 第三节 模块</h3> <blockquote><p>module（模块）：每一个js文件，就是一个模块</p> <p>package（包）：由多个模块组成，将某个独立的功能封装起来</p></blockquote> <p>模块是Node.js 应用程序的基本组成部分，文件和模块是一一对应的。换言之，一个xxx.js 文件就是一个模块，这个文件可能是JavaScript 代码、JSON 或者编译过的C/C++ 扩展。</p> <p>Node.js 提供了 <strong>exports</strong> 和 <strong>require</strong> 两个对象，其中：</p> <p>exports： 是公开模块的接口</p> <p>require ：用于从外部获取一个模块的接口（即所获取模块的 exports 对象）。</p> <h4 id="创建模块"><a href="#创建模块" class="header-anchor">#</a> 创建模块</h4> <p>创建 hello.js 文件，代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> txt<span class="token operator">=</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">run</span><span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//输出对象</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>hi<span class="token operator">=</span>run<span class="token punctuation">;</span> <span class="token comment">//module是公开的接口（对象），exports是向module上添加属性或方法</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="引入模块"><a href="#引入模块" class="header-anchor">#</a> 引入模块</h4> <p>创建一个 main.js，在main.js中引入hello.js模块</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//必须写路径！！！（可以省略.js后缀名） </span>

hello<span class="token punctuation">.</span><span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//通过 require('./hello') 加载模块，就可以直接访问hello.js中module对象的成员函数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在 Node.js 模块系统中，如果 require 的模块不是核心模块，而且没有 <code>./</code> 之类的开头，就需要从当前目录的 node_modules 里面找，找不到就到上层 node_modules 里面找... 一直找到全局 node_modules 目录。</p> <p>如果找到的目录下有 package.json，就根据它的 main 字段找到 js 文件。如果没有 package.json，那就<strong>默认取文件夹下的 index.js</strong>。</p> <h4 id="npm"><a href="#npm" class="header-anchor">#</a> NPM</h4> <p>NPM（Node Package Manager）是随同NodeJS一起安装的。node根据<a href="http://www.commonjs.org/" target="_blank" rel="noopener noreferrer">common JS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>规范实现了包机制，并开发了npm来解决包的发布和获取需求，是NodeJS包管理和分发工具。（详见 NPM笔记）</p> <p>使用：</p> <ol><li>安装包</li> <li>引入包</li> <li>使用包</li></ol> <h4 id="核心模块"><a href="#核心模块" class="header-anchor">#</a> 核心模块</h4> <p>Node.js本身提供了很多核心模块（又称为内置模块、原生模块），用于与操作系统互动（读写文件，访问网络等），这些核心模块被编译成二进制文件，具有最高的加载优先级。</p> <h3 id="第四节-nodejs和浏览器中js的区别"><a href="#第四节-nodejs和浏览器中js的区别" class="header-anchor">#</a> 第四节 Nodejs和浏览器中js的区别</h3> <p>浏览器中js组成：  ES核心 +  BOM + DOM</p> <p>Nodejs中js组成： ES核心 + 全局成员(全局对象) + 模块系统（系统模块、第三方模块、自定义模块）</p> <p>全局成员： setTimeout、setInterval、console.log() 等。</p> <p>注意：这几个名称和功能虽然和浏览器中的一样，但是是Nodejs自己实现的，与浏览器无关</p> <h2 id="第二章-http-模块"><a href="#第二章-http-模块" class="header-anchor">#</a> 第二章 http 模块</h2> <p>Node.js 标准库提供了 http 模块，其中封装了一个高效的 <strong>HTTP 服务器</strong> 和一个简易的 <strong>HTTP 客户端</strong></p> <table><thead><tr><th>方法</th> <th>说明</th></tr></thead> <tbody><tr><td>http.Server()</td> <td>构造函数，服务器是这个构造函数的实例<br>例：const sev=new http.Server()</td></tr> <tr><td>http.createServer(callback）</td> <td>工厂模式创建服务器的（快捷方法）</td></tr> <tr><td>http.request(options,callback)</td> <td>客户端工具，用于向 HTTP 服务器发起请求（没有域的限制）<br>options是构建请求的必要参数<br>callback是请求成功后执行的回调函数，需要传递一个参数<br>options是一个对象，表示请求的参数，常用的参数有host、port（默认为80）、method（默认为GET）、path（请求的相对于根的路径，默认是“/”。</td></tr></tbody></table> <h3 id="第一节-网络基础及http协议"><a href="#第一节-网络基础及http协议" class="header-anchor">#</a> 第一节 网络基础及HTTP协议</h3> <h4 id="网站基础概念"><a href="#网站基础概念" class="header-anchor">#</a> 网站基础概念</h4> <h5 id="网络"><a href="#网络" class="header-anchor">#</a> 网络</h5> <h5 id="url地址"><a href="#url地址" class="header-anchor">#</a> URL地址</h5> <p>浏览器中输入的地址：  127.0.0.1/buy/index.html</p> <p>实际全地址：</p> <p>http://www.baidu.com/</p> <p>http://127.0.0.1:80/buy/index.html</p> <ul><li>http： 协议名, http协议（超文本传输协议）</li> <li>127.0.0.1： 服务器IP地址</li> <li>80： Apache服务器的默认端口号</li> <li>/buy/index.html： 要访问的文件路径</li></ul> <h5 id="域名"><a href="#域名" class="header-anchor">#</a> 域名</h5> <p>域名（Domain Name）： 每个网站都有一个自己的域名。人们可以在浏览器中输入域名来访问对应的网站。</p> <p>技术学派：www.jishuxuepai.com</p> <p>淘宝: www.taobao.com</p> <p>百度: www.baidu.com</p> <p>特殊域名：
​          localhost: 本地主机。在浏览器中输入localhost就会访问当前操作的这台电脑的web服务器。</p> <h5 id="ip地址"><a href="#ip地址" class="header-anchor">#</a> <strong>IP</strong>地址</h5> <p>IP: Internet Protocol  互联网协议，是为计算机网络相互连接进行通信而设计的协议。</p> <ul><li>处于网络（互联网、局域网）上的任何一台计算机都有一个独立的ip地址。</li> <li>ip地址由4段3位长度的数字组成， 3位数字的取值范围 0-255。如： 102.15.201.10</li></ul> <p>特殊ip:</p> <ul><li>127.0.0.1 : 回环地址，每一台电脑都有该ip，指向当前使用的电脑</li> <li>192.168.**.* *: 该网段是专门用于做局域网的ip段。</li></ul> <h5 id="dns"><a href="#dns" class="header-anchor">#</a> DNS</h5> <p>域名虽然也是唯一的，但是要在互联网上找到一个具体网站，还是要靠IP地址。</p> <p>DNS: Domain Name System  域名系统。在DNS服务器中保存了域名和IP的映射关系。主要工作是将域名转换为IP地址，因为我们通过浏览器访问网站时，实际上是去找对应的IP地址。</p> <p>域名: 网站的名称，就相当于人名。
IP: 网站在网络上的实际地址，就相当于人的住址。</p> <p>一般访问网站时都是输入域名的(例如： www.tmall.com  www.163.com)，但是在实际访问时域名会被DNS转换为IP地址。</p> <p>工作步骤:</p> <ol><li><p>在浏览器中输入  www.taobao.com，按下回车</p></li> <li><p>浏览器首先在本机中的 hosts文件和dns缓存中查询，www.taobao.com的IP地址。如果有，则获取该IP地址，然后去访问淘宝服务器。 如果没有，则向dns服务器发送解析请求。</p></li> <li><p>dns服务器获取到浏览器请求信息之后， 将域名转换为IP地址，再将IP地址返回给浏览器。</p></li> <li><p>浏览器获取到IP地址，然后通过IP地址访问淘宝服务器。</p></li></ol> <p>windows下查看dns缓存:
​    ipconfig  /displaydns
​    ipconfig  /displaydns &gt; c:/dnscache.txt   将dns缓存导入到c:/dnscache.txt文件</p> <p>windows下清除dns缓存
​    ipconfig  /flushdns</p> <p>Android和ios，hosts文件都在  /etc/hosts</p> <h5 id="端口"><a href="#端口" class="header-anchor">#</a> 端口</h5> <p>端口是英文port的意译。端口可以理解为区分服务器上服务的标号。</p> <p>已被占用的著名端口号：
​    80:   Web服务器端口号， Apache、Nginx、IIS
​    3306: MySQL默认端口号
​    8080: tomcat默认端口号
​    21:   FTP端口号， FTP软件
​    22:   SSH端口号
​    25:   sendmail端口号
​    ......</p> <p>因为Web服务的默认端口号是80，所以在地址栏可以不输入，但是如果将端口号改为其他的（如：8088），那就必须输入端口号，才能正常访问。</p> <p>端口号的取值范围： 0-65535</p> <h4 id="http协议"><a href="#http协议" class="header-anchor">#</a> HTTP协议</h4> <ul><li><p>协议: 就是事先的一种约定、规则、规范、标准。（租房合同、工作合同）。</p></li> <li><p>HTTP协议（HyperText Transfer Protocol ）：超文本传输协议，客户端（浏览器端）与WEB服务器端之间的交互协议。当浏览器和服务器进行数据交换时，html文件、图片、CSS、JS等都是基于HTTP协议进行传输的。HTTP协议有两个版本: 1.0 和 1.1，目前使用的基本都是1.1。</p></li></ul> <h5 id="请求响应模式"><a href="#请求响应模式" class="header-anchor">#</a> 请求响应模式</h5> <ul><li>HTTP协议主要分为两大部分:
请求:  访问服务器的任何一个文件都是一次请求
响应:  服务器处理请求，将结果返回给浏览器。</li> <li>特点:
通常是基于 B/S 结构软件的。
无连接: 浏览器向服务器发送一次请求，服务器响应一次，链接即结束。
无状态: 服务器不能记住哪个浏览器访问过。</li></ul> <h3 id="第二节-web服务器"><a href="#第二节-web服务器" class="header-anchor">#</a> 第二节 Web服务器</h3> <h4 id="创建web服务器"><a href="#创建web服务器" class="header-anchor">#</a> 创建web服务器</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 引入http模块</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">http<span class="token punctuation">.</span>Server</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 监听事件</span>
app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">// req:客户端请求 res：响应（回应）请求</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置响应头信息（html类型，utf-8编码）</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;text/html;charset=utf-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'hello world 你好'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 参数只能是字符串</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'响应结束'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 参数只能是字符串</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 定义端口</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//输出一条提示语句</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;server is running at 127.0.0.1:8080&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="createserver"><a href="#createserver" class="header-anchor">#</a> createServer</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//使用createServer快速创建web服务器</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置响应头信息</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;text/html;charset=utf-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'hello world 你好'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'响应结束'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//输出一条提示语句</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;server is running at 8080:127.0.0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="回调参数之res对象"><a href="#回调参数之res对象" class="header-anchor">#</a> 回调参数之res对象</h4> <p>res（response）对象是返回给客户端的信息，决定了用户最终能收到的结果。其方法如下：</p> <table><thead><tr><th>response方法</th> <th>说明</th></tr></thead> <tbody><tr><td>res.writeHead(statusCode, [headers])</td> <td>向请求的客户端发送响应头（不调用，则会自动生成一个响应头）。<br>该函数在一个请求内只能调用一次。<br>statusCode：是 HTTP 状态码，如 200 、404等。<br>headers：是一个对象，表示响应头的每个属性。</td></tr> <tr><td>res.write(data, [encoding])</td> <td>向请求的客户端发送响应内容。<br>data 是 一个 Buffer 或字符串，表示要发送的内容。如果 data 是字符串，那么需要指定 encoding 来说明它的编码方式，默认是utf-8。<br>在 res.end 调用之前， res.write 可以被多次调用。</td></tr> <tr><td>res.end([data], [encoding])</td> <td>结束响应，告知客户端所有发送已经完成。<br>当所有返回的内容发送完毕的时候，该函数必须被调用一次。它接受两个可选参数（与 res.write 参数相同）。如果不调用该函数，客户端将永远处于等待状态。</td></tr></tbody></table> <h5 id="常见响应状态码"><a href="#常见响应状态码" class="header-anchor">#</a> 常见响应状态码</h5> <p>200 ok   -----   请求成功</p> <p>302 redirect|Found  ----- 重定向 (页面跳转)</p> <p>304 not modified ----- 未修改</p> <p>403 forbidden   -----  禁止访问 （没有权限访问）</p> <p>404 Not Found  -----  未找到页面</p> <p>500 internal server error  ----- 服务器内部错误 (可能是服务器本身有问题，或者代码错的太离谱)</p> <p>http://tool.oschina.net/commons?type=5</p> <h4 id="回调参数之req对象"><a href="#回调参数之req对象" class="header-anchor">#</a> 回调参数之req对象</h4> <p>req（request）对象表示客户端发送来的HTTP请求，包含：请求方法、url、HTTP请求头等信息，其属性如下：</p> <table><thead><tr><th>request属性</th> <th>含义</th></tr></thead> <tbody><tr><td>method</td> <td>HTTP请求方法，如：GET、POST</td></tr> <tr><td>url</td> <td>url地址</td></tr> <tr><td>headers</td> <td>HTTP请求头信息</td></tr></tbody></table> <h5 id="多次请求和响应"><a href="#多次请求和响应" class="header-anchor">#</a> 多次请求和响应</h5> <h3 id="第三节-web客户端"><a href="#第三节-web客户端" class="header-anchor">#</a> 第三节 Web客户端</h3> <p>http模块不但可以搭建后端web服务器，<strong>http.request</strong> 方法还可以扮演客户端角色，向HTTP服务器发起请求。</p> <h4 id="发送get请求"><a href="#发送get请求" class="header-anchor">#</a> 发送get请求</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> http<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//请求配置</span>
<span class="token keyword">let</span> opt<span class="token operator">=</span><span class="token punctuation">{</span>
	host<span class="token punctuation">:</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
	port<span class="token punctuation">:</span><span class="token number">8080</span><span class="token punctuation">,</span>
	method<span class="token punctuation">:</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span>
	path<span class="token punctuation">:</span><span class="token string">&quot;/getData?name=zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token comment">//别忘了加上&quot;/&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">//用于接收数据</span>
<span class="token keyword">let</span> con<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">//创建请求</span>
<span class="token keyword">let</span> req<span class="token operator">=</span>http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>opt<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//res：接收响应数据，此res与createServer的res不同</span>

	<span class="token comment">//监听返回数据</span>
	res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chuck</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		con<span class="token operator">+=</span>chuck<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//监听数据接收完</span>
	res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data:&quot;</span><span class="token punctuation">,</span>con<span class="token punctuation">)</span><span class="token comment">//接收的数据</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//监听错误</span>
req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;错误：&quot;</span><span class="token operator">+</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//返回一个err对象，错误信息保存在err.message中</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//结束请求</span>
req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h4 id="发送post请求"><a href="#发送post请求" class="header-anchor">#</a> 发送post请求</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> http<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> qs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;querystring&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用于解析post请求的query</span>

<span class="token comment">//请求配置</span>
<span class="token keyword">let</span> opt<span class="token operator">=</span><span class="token punctuation">{</span>
	host<span class="token punctuation">:</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
	port<span class="token punctuation">:</span><span class="token number">8080</span><span class="token punctuation">,</span>
	method<span class="token punctuation">:</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
	path<span class="token punctuation">:</span><span class="token string">&quot;/getData&quot;</span><span class="token punctuation">,</span> <span class="token comment">//别忘了加上&quot;/&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">//用于接收数据</span>
<span class="token keyword">let</span> con<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

<span class="token comment">//创建请求</span>
<span class="token keyword">let</span> req<span class="token operator">=</span>http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>opt<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//res：接收响应数据</span>
	
	<span class="token comment">//监听返回数据</span>
	res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chuck</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		con<span class="token operator">+=</span>chuck<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//监听数据接收完</span>
	res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data:&quot;</span><span class="token punctuation">,</span>con<span class="token punctuation">)</span><span class="token comment">//接收的数据</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//监听错误</span>
req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;错误：&quot;</span><span class="token operator">+</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//返回一个err对象，错误信息保存在err.message中</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//要发送的请求数据</span>
<span class="token keyword">let</span> msg<span class="token operator">=</span><span class="token punctuation">{</span>
	name<span class="token punctuation">:</span><span class="token string">&quot;zhangsan&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">//对象转换为post请求的字符串</span>
<span class="token keyword">let</span> postData<span class="token operator">=</span>qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//将数据写入到http协议体中</span>
req<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>postData<span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">//结束请求</span>
req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h2 id="第三章-fs模块"><a href="#第三章-fs模块" class="header-anchor">#</a> 第三章 fs模块</h2> <p>fs（file system）文件系统用于对系统文件及目录进行读写操作</p> <h3 id="第一节-文件操作"><a href="#第一节-文件操作" class="header-anchor">#</a> 第一节 文件操作</h3> <table><thead><tr><th>方法（异步）</th> <th>功能</th></tr></thead> <tbody><tr><td>fs.readFile(filename,[options],callback)</td> <td>读取文件（非堵塞，性能更好） <br>options：编码：“ ascii 、utf-8 ”等 <br>（未编码：二进制数据流Buffer，编码后：文本）<br>callback：function（err，data）</td></tr> <tr><td>fs.writeFile(filename,data,[options],callback)</td> <td>覆盖方式写文件（文件不存在，先创建）<br>options：指定权限，读、写、执行。是否可续写</td></tr> <tr><td>fs.appendFile(filename,data,[options],callback)</td> <td>追加方式写文件（文件不存在，先创建）<br>data：文本或buffer流</td></tr> <tr><td>fs.unlink(path, callback)</td> <td>删除文件</td></tr> <tr><td>fs.stat(path,callback)</td> <td>检测文件状态<br> callback：function（err，stats）<br>err：错误信息，stats：文件状态对象<br>判断文件：stats.isFile() <br>判断目录：stats. isDirectory()</td></tr> <tr><td>fs.exists(path,callback)</td> <td>查看 <strong>文件</strong> 或 **目录 **是否存在</td></tr> <tr><td>fs.rename(oldname,newname,callback)</td> <td>重命名文件名或者目录</td></tr></tbody></table> <h4 id="文件读取-readfile"><a href="#文件读取-readfile" class="header-anchor">#</a> 文件读取 --- readFile</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> var2<span class="token punctuation">,</span> var3<span class="token punctuation">)</span><span class="token punctuation">;</span>
参数<span class="token number">1</span><span class="token punctuation">:</span> 要读取的文件路径 <span class="token operator">--</span><span class="token operator">-</span> 相对路径和绝对路径均可。
参数<span class="token number">2</span><span class="token punctuation">:</span> 配置项，主要用来配置字符集。可选参数。
      如果不设置该参数，文件内容会以二进制形式返回
参数<span class="token number">3</span><span class="token punctuation">:</span> 读取完成后触发的回调函数，有两个参数 <span class="token operator">--</span><span class="token operator">-</span> err 和 result
     读取成功<span class="token punctuation">:</span>
         err<span class="token punctuation">:</span> <span class="token keyword">null</span>
         result<span class="token punctuation">:</span> 文件内容，如果不设置参数<span class="token number">2</span><span class="token punctuation">,</span>则返回二进制数据。可以使用 <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 方法将二进制数据
                 转为正常字符串
     读取失败<span class="token punctuation">:</span>
         err<span class="token punctuation">:</span> 错误对象
         result<span class="token punctuation">:</span> <span class="token keyword">undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="文件写入-writefile"><a href="#文件写入-writefile" class="header-anchor">#</a> 文件写入 --- writeFile</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//向指定文件中写入字符串（覆盖写入）， 如果没有该文件则尝试创建该文件</span>

fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>var1<span class="token punctuation">,</span> var2<span class="token punctuation">,</span> var3<span class="token punctuation">,</span> var4<span class="token punctuation">)</span><span class="token punctuation">;</span>
参数<span class="token number">1</span><span class="token punctuation">:</span> 要写入的文件路径 <span class="token operator">--</span><span class="token operator">-</span> 相对路径和绝对路径均可，推荐使用绝对路径
参数<span class="token number">2</span><span class="token punctuation">:</span> 要写入文件的字符串
参数<span class="token number">3</span><span class="token punctuation">:</span> 配置项，设置写入的字符集，默认utf<span class="token operator">-</span><span class="token number">8</span>
参数<span class="token number">4</span><span class="token punctuation">:</span> 写入完成后触发的回调函数，有一个参数 <span class="token operator">--</span><span class="token operator">-</span> err （错误对象）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="文件追加-appendfile"><a href="#文件追加-appendfile" class="header-anchor">#</a> 文件追加 --- appendFile</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//向指定文件中写入字符串（追加写入）， 如果没有该文件则尝试创建该文件</span>

fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span>var1<span class="token punctuation">,</span> var2<span class="token punctuation">,</span> var3<span class="token punctuation">,</span> var4<span class="token punctuation">)</span><span class="token punctuation">;</span>
参数<span class="token number">1</span><span class="token punctuation">:</span> 要写入的文件路径 <span class="token operator">--</span><span class="token operator">-</span> 相对路径和绝对路径均可，推荐使用绝对路径
参数<span class="token number">2</span><span class="token punctuation">:</span> 要写入文件的字符串
参数<span class="token number">3</span><span class="token punctuation">:</span> 配置项，设置写入的字符集，默认utf<span class="token operator">-</span><span class="token number">8</span>
参数<span class="token number">4</span><span class="token punctuation">:</span> 写入完成后触发的回调函数，有一个参数 <span class="token operator">--</span><span class="token operator">-</span> err （错误对象）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="日志系统"><a href="#日志系统" class="header-anchor">#</a> 日志系统</h5> <h4 id="同步与异步操作"><a href="#同步与异步操作" class="header-anchor">#</a> 同步与异步操作</h4> <table><thead><tr><th>方法</th> <th>说明</th></tr></thead> <tbody><tr><td>同步（Synchronous）</td> <td>同步方法执行的操作结束之前，不能执行后续代码的执行</td></tr> <tr><td>异步（Asynchronous）</td> <td>将操作结果作为回调函数的参数进行返回，<br>方法调用之后，就可以立即执行后续的代码，读取完毕后会调用对应的回调函数</td></tr></tbody></table> <p><strong>在fs模块中，所有的方法都分为同步和异步两种实现</strong>。异步操作不会造成堵塞，工作效率更高。例如：</p> <table><thead><tr><th>方法</th> <th>说明</th></tr></thead> <tbody><tr><td>fs.readFile(path[, options], callback)</td> <td><strong>异步</strong>读取文件（有callback）</td></tr> <tr><td>fs.readFileSync(path[, options])</td> <td><strong>同步</strong>读取文件（无callback）</td></tr></tbody></table> <p>但是，在一些特殊操作中，例如：遍历目录的递归操作时，就要使用同步操作。</p> <h3 id="第二节-目录操作"><a href="#第二节-目录操作" class="header-anchor">#</a> 第二节 目录操作</h3> <table><thead><tr><th>方法</th> <th>说明</th></tr></thead> <tbody><tr><td>fs.readdir(path,callback)</td> <td>读取目录</td></tr> <tr><td>fs.mkdir(path,[mode],callback)</td> <td>创建目录<br>path：被创建目录的完整路径以及目录名（绝对路径）<br>[mode]：目录权限，默认0777（可读可写可执行）</td></tr> <tr><td>fs.rmdir(path,callback)</td> <td>删除 <strong>空</strong> 目录</td></tr></tbody></table> <h2 id="第四章-path模块"><a href="#第四章-path模块" class="header-anchor">#</a> 第四章 path模块</h2> <p>首先区分以下前端（http请求）路径与后端（硬盘）路径的区别：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http请求路径
┌─────────────────────┬────────────┐
│          dir        │    base    │
├──────┬              ├──────┬─────┤
│ root │              │ name │ ext │
&quot;  /    home/user/dir / file  .txt &quot;
└──────┴──────────────┴──────┴─────┘

硬盘路径
┌─────────────────────┬────────────┐
│          dir        │    base    │
├──────┬              ├──────┬─────┤
│ root │              │ name │ ext │
&quot; C:\      path\dir   \ file  .txt &quot;
└──────┴──────────────┴──────┴─────┘
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>操作文件，就必定会遇到解析各种复杂路径的问题，path是用于处理<strong>服务器（硬盘）上</strong>的文件路径的内置模块。</p> <table><thead><tr><th>方法</th> <th>说明</th></tr></thead> <tbody><tr><td>path.normalize()</td> <td>规范化给定的 <code>path</code>，修正格式错误，并解析 <code>'..'</code> 和 <code>'.'</code> 片段</td></tr> <tr><td>path.join()</td> <td>路径合并</td></tr> <tr><td>path.resolve(字符串)</td> <td>获取绝对路径</td></tr> <tr><td>path.relative(from，to)</td> <td>获取from 到 to 相对路径</td></tr> <tr><td>path.parse(路径)</td> <td>将路径解析成对象</td></tr> <tr><td>path.basename(path[, ext])</td> <td>获取文件名（ext：可排除后缀名）</td></tr> <tr><td>path.dirname(path)</td> <td>获取文件路径</td></tr> <tr><td>path.extname(path)</td> <td>获取文件后缀名</td></tr></tbody></table> <h2 id="第二章-url模块"><a href="#第二章-url模块" class="header-anchor">#</a> 第二章 url模块</h2> <p>用于 <strong>url</strong> 的处理与解析</p> <table><thead><tr><th>方法</th> <th>说明</th></tr></thead> <tbody><tr><td>url.parse(urlString,true)</td> <td>解析URL地址，返回一个对象  <br>true : 可以将对象中query输出为对象</td></tr> <tr><td>url.toString()</td> <td>在URL对象上调用 toString() 方法将返回序列化的URL。<br>返回值与url.href和url.toJSON()的相同</td></tr> <tr><td>url.toJSON()</td> <td>在URL对象上调用 toJSON() 方法将返回序列化的URL。<br>返回值与url.href和url.toString()的相同</td></tr> <tr><td>url.format(urlObj)</td> <td>将传入的对象转换为一个URL字符串并返回</td></tr></tbody></table> <h2 id="第五章-querystring模块"><a href="#第五章-querystring模块" class="header-anchor">#</a> 第五章 querystring模块</h2> <p>用于处理POST请求的query字符串</p> <table><thead><tr><th>方法</th> <th>说明</th></tr></thead> <tbody><tr><td>parse、decode</td> <td>两个方法作用相同，用于将query字符串解析成对象</td></tr> <tr><td>escape</td> <td>参数编码</td></tr> <tr><td>unescape</td> <td>参数解码</td></tr> <tr><td>encode、stringify</td> <td>两个方法作用相同，用于将对象转换成query字符串。<br>如果属性值不是string、boolean和number中的一种，就不能序列化。<br>返回内容中的关键字对应的值为空。</td></tr></tbody></table> <h2 id="第六章-events模块"><a href="#第六章-events模块" class="header-anchor">#</a> 第六章 events模块</h2> <h4 id="事件驱动编程"><a href="#事件驱动编程" class="header-anchor">#</a> 事件驱动编程</h4> <p>事件驱动编程（Evnet-driven programming）是一种编程风格，由事件来决定程序的执行流程，事件由事件处理器（event handler）或事件回调（event callback）来处理，事件回调是当某个特定事件发生时被调用的函数，比如：数据库返回了查询结果或服务器响应到了一个客户端的连接请求。</p> <p>events 是 Node.js 最重要的模块，没有“之一”，原因是 Node.js 本身架构就是事件式的，而它提供了唯一的接口，所以堪称 Node.js 事件编程的基石。大多数时候我们不会直接使用 EventEmitter，而是在对象中继承它。包括 fs、net、 http 在内的，只要是<strong>支持事件响应的核心模块都是 EventEmitter 的子类</strong>。</p> <h4 id="eventemitter"><a href="#eventemitter" class="header-anchor">#</a> EventEmitter</h4> <p>events 模块只提供了一个对象： <strong>events.EventEmitter</strong>，EventEmitter 的核心就 是事件发射与事件监听器功能的封装。EventEmitter 的每个事件由一个事件名和若干个参 数组成，事件名是一个字符串，通常表达一定的语义。对于每个事件，EventEmitter 支持 若干个事件监听器。当事件发射时，注册到这个事件的事件监听器被依次调用，事件参数作为回调函数参数传递。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">events<span class="token punctuation">.</span>EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'someEvent'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span> arg2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>后端事件与前端DOM树上的事件有所不相同，因为它不存在冒泡，逐层捕获等属于DOM的事件行为，也没有preventDefault()、stopPropagation()等处理事件传递的方法。</p> <p>事件侦听器模式是一种事件钩子（hook）的机制，通过事件钩子的方式，可以使编程者不用关注组件是如何启动和执行的，只需关注在需要的事件点上即可。作为后端服务器来说，Node.js重点事件更常见的是网络事件，包括：</p> <ol><li>来自web服务器的响应</li> <li>从文件读取数据</li> <li>从数据库返回数据</li></ol> <table><thead><tr><th>EventEmitter对象方法</th> <th>描述</th></tr></thead> <tbody><tr><td>addListener(event,listener)</td> <td>为指定事件绑定事件处理函数</td></tr> <tr><td>on(event, listener)</td> <td>addListener方法的别名</td></tr> <tr><td>once(event, listener)</td> <td>为指定事件注册单次监听器，触发后立刻解除该监听器</td></tr> <tr><td>removeListener(event, listener)</td> <td>移除指定事件的某个监听器</td></tr> <tr><td>setMaxListeners(n)</td> <td>指定事件处理函数的最大数量，<br>n为整数值，代表最大的可指定事件处理函数的数量</td></tr> <tr><td>listeners(event)</td> <td>获取指定事件的所有事件处理函数</td></tr> <tr><td>emit(event, [arg1], [arg2], [...])</td> <td>手工触发指定事件</td></tr></tbody></table> <h2 id="第七章-utilities模块"><a href="#第七章-utilities模块" class="header-anchor">#</a> 第七章 utilities模块</h2> <p>弥补js功能不足，新增的部分API。</p> <table><thead><tr><th>方法</th> <th>说明</th></tr></thead> <tbody><tr><td>util.format()</td> <td>返回一个格式化后的字符串</td></tr> <tr><td>util.inspect()</td> <td>将对象转换为字符串</td></tr> <tr><td>util.isArray()</td> <td>判断是否是数组</td></tr> <tr><td>util.isRegExp()</td> <td>判断是否是正则对象</td></tr> <tr><td>util.isDate()</td> <td>判断是否是日期对象</td></tr> <tr><td>util.isError()</td> <td>判断是否是error对象</td></tr> <tr><td>util.promisify(original)</td> <td>转换为基于promise的方法</td></tr></tbody></table> <h2 id="第八章-express-框架"><a href="#第八章-express-框架" class="header-anchor">#</a> 第八章 Express 框架</h2> <p>Express  ( http://expressjs.com/ ) 是目前最稳定、使用最广泛，而且 Node.js 官方推荐的唯一一个 Web 开发框架。</p> <p>Express除了为 http 模块提供了更高层的接口外，还实现了许多功能，其中包括:</p> <ul><li>路由控制;</li> <li>模板解析支持;</li> <li>动态视图;</li> <li>用户会话;</li> <li>CSRF 保护;</li> <li>静态文件服务;</li> <li>错误控制器;</li> <li>访问日志;</li> <li>缓存;</li> <li>插件支持;</li></ul> <p>它只是一个轻量级的 Web 框架，多数功能只是对 HTTP 协议中常用操作的封装，更多的功能需要插件或者整合其他模块来完成。</p> <h3 id="第一节-使用express构造web服务器"><a href="#第一节-使用express构造web服务器" class="header-anchor">#</a> 第一节 使用Express构造Web服务器</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 下载 express 模块</span>
<span class="token function">npm</span> i express
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>使用Express构建Web服务器步骤：</p> <ol><li><p>加载 express 模块</p></li> <li><p>创建 express 服务器</p></li> <li><p>开启服务器</p></li> <li><p>监听浏览器请求并进行处理 (监听路由)</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//1. 加载 express 模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2. 创建express(Web) 服务器</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3. 开启服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express-server is running...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//4. 监听浏览器请求并进行处理</span>
<span class="token comment">//get(): 用来接收get请求</span>
<span class="token comment">//post(): 用来接收post请求，</span>
<span class="token comment">//如果浏览器请求的地址为 http://127.0.0.1:3000/index，则会执行该方法</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/index'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'index-page'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>  
<span class="token comment">//如果浏览器请求的地址为 http://127.0.0.1:3000/login，则会执行该方法</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//send方法是express封装的方法</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'登录页'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// * : 通配符，代表任意地址</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'404 not found'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ol><li>使用express构造服务器也是4步流程：</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>① 加载express模块         const express = require('express');
② 创建express服务器       const app = express();
③ 开启express服务器       app.listen(3000, () =&gt; {})
④ 注册服务器事件           app.get(url, callback)   app.post(url, callback)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>注册服务器事件有两个方法： get() 和 post()</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>get方法用来接收get请求，浏览器地址栏发起的请求都是get请求
post方法用来接收post请求，接收post表单提交的请求
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li><p>express框架封装了一些额外的API（例如:send），可以让我们更方便的构造Web服务器</p></li> <li><p>浏览器请求的每一个url地址都会由一个独立方法接收并处理，没有了 if ... else if ... else 这样的分支，程序结构
​     更加清晰</p></li></ol> <h3 id="response"><a href="#response" class="header-anchor">#</a> response</h3> <h4 id="send"><a href="#send" class="header-anchor">#</a> send</h4> <h4 id="sendfile"><a href="#sendfile" class="header-anchor">#</a> sendFile</h4> <p>重定向</p> <h3 id="静态文件"><a href="#静态文件" class="header-anchor">#</a> 静态文件</h3> <p>为了提供诸如图像、CSS 文件和 JavaScript 文件之类的静态文件，请使用 Express 中的 <code>express.static</code> 内置中间件函数。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>现在，你就可以访问 <code>public</code> 目录中的所有文件了：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http://localhost:3000/images/kitten.jpg
http://localhost:3000/css/style.css
http://localhost:3000/js/app.js
http://localhost:3000/images/bg.png
http://localhost:3000/hello.html
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h3> <h4 id="any"><a href="#any" class="header-anchor">#</a> any</h4> <p>404页面</p> <h4 id="路由参数"><a href="#路由参数" class="header-anchor">#</a> 路由参数</h4> <h4 id="querystring"><a href="#querystring" class="header-anchor">#</a> QueryString</h4> <h3 id="中间件"><a href="#中间件" class="header-anchor">#</a> 中间件</h3> <h2 id="第九章-koa-框架"><a href="#第九章-koa-框架" class="header-anchor">#</a> 第九章 Koa 框架</h2> <h3 id="第一节-koa-介绍"><a href="#第一节-koa-介绍" class="header-anchor">#</a> 第一节 Koa 介绍</h3> <p>koa是Express的下一代基于Node.js的web框架，目前有1.x和2.0两个版本。</p> <blockquote><p>koa 是由 Express 原班人马打造的，致力于成为一个更小、更富有表现力、更健壮的 Web 框架。使用 koa 编写 web 应用，通过组合不同的 generator，可以免除重复繁琐的回调函数嵌套，并极大地提升错误处理的效率。koa 不在内核方法中绑定任何中间件，它仅仅提供了一个轻量优雅的函数库，使得编写 Web 应用变得得心应手。</p></blockquote> <h4 id="_1-express"><a href="#_1-express" class="header-anchor">#</a> 1. Express</h4> <p>Express是第一代最流行的web框架，它对Node.js的http进行了封装，用起来如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Example app listening on port 3000!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>虽然Express的API很简单，但是它是基于ES5的语法，要实现异步代码，只有一个方法：<strong>回调</strong>。如果异步嵌套层次过多，代码写起来就非常难看：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/test'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/file1'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'read file1 error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/file2'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'read file2 error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_2-koa1"><a href="#_2-koa1" class="header-anchor">#</a> 2. koa1</h4> <p>随着新版Node.js开始支持ES6，Express的团队又基于ES6的generator重新编写了下一代web框架koa。和Express相比，koa 1.0使用<strong>generator</strong>实现异步。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/test'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">doReadFile1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">doReadFile2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>body <span class="token operator">=</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_3-koa2"><a href="#_3-koa2" class="header-anchor">#</a> 3. koa2</h4> <p>koa团队基于ES7开发了koa2，和koa1相比，koa2完全使用<strong>Promise</strong>并配合<code>async</code>来实现异步。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">doReadFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text/plain'</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="第二节-hello-koa"><a href="#第二节-hello-koa" class="header-anchor">#</a> 第二节 Hello Koa</h3> <ol><li><h4 id="创建项目目录"><a href="#创建项目目录" class="header-anchor">#</a> 创建项目目录</h4></li> <li><h4 id="初始化package-json"><a href="#初始化package-json" class="header-anchor">#</a> 初始化package.json</h4></li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> <span class="token function">npm</span> init -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="3"><li><h4 id="安装koa"><a href="#安装koa" class="header-anchor">#</a> 安装Koa</h4></li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> koa --save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="4"><li><h4 id="创建web服务"><a href="#创建web服务" class="header-anchor">#</a> 创建Web服务</h4></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 导入koa，和koa 1.x不同，在koa2中，我们导入的是一个class，因此用大写的Koa表示:</span>
<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个Koa对象表示web app本身:</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在端口3000监听:</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'app started at port 3000...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="5"><li><h4 id="请求与响应"><a href="#请求与响应" class="header-anchor">#</a> 请求与响应</h4></li></ol> <p>每收到一个http请求，koa就会调用通过<code>app.use()</code>注册的async函数，并传入<code>ctx</code>和<code>next</code>参数。</p> <p>其中，参数<code>ctx</code>是由koa传入的封装了<code>request</code>和<code>response</code>的变量，<code>next</code>是koa传入的将要处理的下一个异步函数。</p> <p><code>ctx</code>对象有一些简写的方法，例如<code>ctx.url</code>相当于<code>ctx.request.url</code>，<code>ctx.type</code>相当于<code>ctx.response.type</code>。</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">// 导入koa，和koa 1.x不同，在koa2中，我们导入的是一个class，因此用大写的Koa表示:</span>
<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个Koa对象表示web app本身:</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 对于任何请求，app将调用该异步函数处理请求：</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text/html'</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'&lt;h1&gt;Hello, koa2!&lt;/h1&gt;'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在端口3000监听:</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'app started at port 3000...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ol start="6"><li><h4 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h4></li></ol> <p>我们打开浏览器，输入<code>http://localhost:3000</code>，即可看到效果。</p> <h3 id="第三节-中间件-middleware"><a href="#第三节-中间件-middleware" class="header-anchor">#</a> 第三节 中间件 middleware</h3> <p>koa把很多async函数组成一个处理链，每个async函数都可以做一些自己的事情，然后用<code>await next()</code>来调用下一个async函数。我们把每个async函数称为middleware，这些middleware可以组合起来，完成很多有用的功能。</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">// 导入koa，和koa 1.x不同，在koa2中，我们导入的是一个class，因此用大写的Koa表示:</span>
<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个Koa对象表示web app本身:</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 对于任何请求，app将调用该异步函数处理请求：</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text/html'</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'&lt;h1&gt;Hello, koa2!&lt;/h1&gt;'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在端口3000监听:</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'app started at port 3000...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>案例1：打印请求日志</p> <p>案例2：记录处理时间</p> <h3 id="第四节-路由"><a href="#第四节-路由" class="header-anchor">#</a> 第四节 路由</h3> <p>为了处理URL，我们需要引入<code>koa-router</code>这个middleware，让它负责处理URL映射。</p> <h4 id="_1-路由的使用"><a href="#_1-路由的使用" class="header-anchor">#</a> 1. 路由的使用</h4> <p>安装 <code>koa-router</code> 并使用路由</p> <div class="language-js {2, 6-8, 10-11} line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 注意require('koa-router')返回的是函数，后面有一个()调用该函数:</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'&lt;h1&gt;Index&lt;/h1&gt;'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 注册路由中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'app started at port 3000...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>注意导入<code>koa-router</code>的语句最后的<code>()</code>是函数调用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>相当于：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fn_router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">fn_router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-路由参数"><a href="#_2-路由参数" class="header-anchor">#</a> 2. 路由参数</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// add url-route:</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/hello/:name'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1&gt;Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!&lt;/h1&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>http://localhost:3000/hello/koa</p> <h4 id="_3-请求类型"><a href="#_3-请求类型" class="header-anchor">#</a> 3. 请求类型</h4> <p>用<code>router.get('/path', async fn)</code>处理的是get请求。如果要处理post请求，可以用<code>router.post('/path', async fn)</code>。类似的，put、delete、head请求也可以由router处理。</p> <h4 id="_4-处理post请求"><a href="#_4-处理post请求" class="header-anchor">#</a> 4. 处理Post请求</h4> <p>post请求通常会发送一个表单，或者JSON，它作为request的body发送，但无论是Node.js提供的原始request对象，还是koa提供的request对象，都<em>不提供</em>解析request的body的功能，所以，我们又需要引入另一个middleware<code>koa-bodyparser</code>来解析原始request请求，然后，把解析后的参数，绑定到<code>ctx.request.body</code>中。</p> <p>使用<code>npm install</code>安装依赖项：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&quot;koa-bodyparser&quot;: &quot;3.2.0&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改<code>app.js</code>，引入<code>koa-bodyparser</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注册中间件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>由于middleware的顺序很重要，这个<code>koa-bodyparser</code>必须在<code>router</code>之前被注册到<code>app</code>对象上。</p> <p>现在我们就可以处理post请求了。写一个简单的登录表单：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1&gt;Index&lt;/h1&gt;
        &lt;form action=&quot;/signin&quot; method=&quot;post&quot;&gt;
            &lt;p&gt;Name: &lt;input name=&quot;name&quot; value=&quot;koa&quot;&gt;&lt;/p&gt;
            &lt;p&gt;Password: &lt;input name=&quot;password&quot; type=&quot;password&quot;&gt;&lt;/p&gt;
            &lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;&lt;/p&gt;
        &lt;/form&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/signin'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> name <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token keyword">let</span> password <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">signin with name: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, password: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>password<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">'koa'</span> <span class="token operator">&amp;&amp;</span> password <span class="token operator">===</span> <span class="token string">'12345'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1&gt;Welcome, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!&lt;/h1&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1&gt;Login failed!&lt;/h1&gt;
        &lt;p&gt;&lt;a href=&quot;/&quot;&gt;Try again&lt;/a&gt;&lt;/p&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>注意到我们用<code>var name = ctx.request.body.name || ''</code>拿到表单的<code>name</code>字段，如果该字段不存在，默认值设置为<code>''</code>。</p> <h3 id="第五节-控制器-controller"><a href="#第五节-控制器-controller" class="header-anchor">#</a> 第五节 控制器 Controller</h3> <p>所有的URL处理函数都放到<code>app.js</code>里显得很乱，而且，每加一个URL，就需要修改<code>app.js</code>。随着URL越来越多，<code>app.js</code>就会越来越长。</p> <p>如果能把URL处理函数集中到某个js文件，或者某几个js文件中就好了，然后让<code>app.js</code>自动导入所有处理URL的函数。这样，代码一分离，逻辑就显得清楚了。最好是这样：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>/
<span class="token operator">|</span>
+- controllers/
<span class="token operator">|</span>  <span class="token operator">|</span>
<span class="token operator">|</span>  +- login.js <span class="token operator">&lt;</span>-- 处理login相关URL
<span class="token operator">|</span>  <span class="token operator">|</span>
<span class="token operator">|</span>  +- users.js <span class="token operator">&lt;</span>-- 处理用户管理相关URL
<span class="token operator">|</span>
+- app.js <span class="token operator">&lt;</span>-- 使用koa的js
<span class="token operator">|</span>
+- package.json <span class="token operator">&lt;</span>-- 项目描述文件
<span class="token operator">|</span>
+- node_modules/ <span class="token operator">&lt;</span>-- npm安装的所有依赖包
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>我们先在<code>controllers</code>目录下编写<code>index.js</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">fn_index</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1&gt;Index&lt;/h1&gt;
        &lt;form action=&quot;/signin&quot; method=&quot;post&quot;&gt;
            &lt;p&gt;Name: &lt;input name=&quot;name&quot; value=&quot;koa&quot;&gt;&lt;/p&gt;
            &lt;p&gt;Password: &lt;input name=&quot;password&quot; type=&quot;password&quot;&gt;&lt;/p&gt;
            &lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;&lt;/p&gt;
        &lt;/form&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">fn_signin</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span>
        name <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
        password <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">signin with name: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, password: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>password<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">'koa'</span> <span class="token operator">&amp;&amp;</span> password <span class="token operator">===</span> <span class="token string">'12345'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1&gt;Welcome, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!&lt;/h1&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1&gt;Login failed!&lt;/h1&gt;
        &lt;p&gt;&lt;a href=&quot;/&quot;&gt;Try again&lt;/a&gt;&lt;/p&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'GET /'</span><span class="token punctuation">:</span> fn_index<span class="token punctuation">,</span>
    <span class="token string">'POST /signin'</span><span class="token punctuation">:</span> fn_signin
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="附录："><a href="#附录：" class="header-anchor">#</a> 附录：</h2> <h3 id="实用工具"><a href="#实用工具" class="header-anchor">#</a> 实用工具</h3> <h4 id="supervisor"><a href="#supervisor" class="header-anchor">#</a> supervisor</h4> <p>supervisor 是一个进程管理工具，它可以监视server.js文件的改动，自动重启web服务。</p> <ol><li>全局安装</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm install supervisor <span class="token operator">-</span>g 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>使用supervisor 命令启动 server.js</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>supervisor server.js 
---------------------------------------------
运行后，显示如下内容：
DEBUG: Running node-supervisor with
DEBUG:   program 'server.js'
DEBUG:   --watch '.'
DEBUG:   --extensions 'node|js'
DEBUG:   --exec 'node' 
DEBUG: Starting child process with 'node serverp.js'
DEBUG: Watching directory '/home/byvoid/.' for changes. 

当代码被改动时，运行的脚本会被终止，然后重新启动。在终端中显示的结果如下： 
DEBUG: crashing child 
DEBUG: Starting child process with 'node server.js' 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="live-server"><a href="#live-server" class="header-anchor">#</a> live-server</h4> <p>live-server是一款简单的开发用的web服务器。它实时监视HTML/JavaScript /CSS文件的改变，当对网页进行编辑时，保存编辑结果后，live-server服务器会立刻更新页面。</p> <ol><li>全局安装</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install live-server -g
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li><p>在项目目录中打开cmd窗口</p></li> <li><p>输入live-server，就可以启动这个服务器，默认端口是：8080，当前目录，就是网站根目录</p></li> <li><p>打开编辑器，编辑该项目中的文件，保存文件后，浏览器中的页面立刻刷新结果</p></li></ol> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td>-v--version</td> <td>版本</td></tr> <tr><td>-h--help</td> <td>帮助</td></tr> <tr><td>-q--quiet</td> <td>退出</td></tr> <tr><td>--port=PORT</td> <td>端口 默认：8080</td></tr> <tr><td>--host=HOST</td> <td>选择要绑定到的主机地址</td></tr> <tr><td>--open=PATH</td> <td>路径</td></tr> <tr><td>--no-browser</td> <td>禁止自动浏览器启动</td></tr> <tr><td>--browser=BROWSER</td> <td>指定浏览器，而不是系统默认</td></tr> <tr><td>--ignore=PATH</td> <td>启动浏览器到路径而不是服务器根</td></tr> <tr><td>--ignorePattern=RGXP</td> <td>要忽略文件的正则表达式（即*.JADE）</td></tr> <tr><td>--wait=MILLISECONDS</td> <td>（默认100毫秒）刷新等待时间（毫秒）</td></tr></tbody></table></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/li-kang/WebNotes/edit/master/docs/notes/Nodejs/readme.md" target="_blank" rel="noopener noreferrer">维护文档</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">9/15/2020, 8:32:27 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.36f33a9d.js" defer></script><script src="/assets/js/2.d27f56d2.js" defer></script><script src="/assets/js/4.e3d63e9c.js" defer></script>
  </body>
</html>